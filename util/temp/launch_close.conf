#!/usr/bin/env bash
###########################################################################################################################################
# Script Name:  launch_close.conf
# Author Name:  Paul Calnon
# Modify Date:  2025-11-21
# Description:  Define Script Constants for launch_close.bash: script to launch api_request bash and close_buildwithus.py scripts.
###########################################################################################################################################
# Notes:
#     Warning:
#         This config file is sourced by launch_close.bash script.
#
#     API Endpoints:
#         Remote: https://api.close.com/buildwithus
#         Local http://127.0.0.1:8050/api/metrics
###########################################################################################################################################


###########################################################################################################################################
# Define Script Constants
set -eE -o functrace

export TRUE=0
export FALSE=1

export DEBUG="${TRUE}"
# export DEBUG="${FALSE}"


###########################################################################################################################################
# Only Source this conf file Once
if [[ "${LAUNCH_CLOSE_CONF_SOURCED}" != "${TRUE}" ]]; then
    export LAUNCH_CLOSE_CONF_SOURCED="${TRUE}"
else
    log_warning "launch_close.conf already sourced.  Skipping re-source."
    return "${TRUE}"
fi


###########################################################################################################################################
# Setup Environment for logging line numbers and function names
export SCRIPT_NAME_ID="1"
export LINE_NO_ID="0"
export FUNC_NAME_ID="1"


###########################################################################################################################################
# Define Script Constants for shell environment
export PYTHON="/usr/bin/python3.14"

export GET_REQUEST_TYPE="GET"
export POST_REQUEST_TYPE="POST"

export SUCCESS="${FALSE}"

export API_REQUEST_CMD=""
export API_REQUEST=""
export CMD_RET=""


###########################################################################################################################################
# Define File Extension Constants
export JSON_EXT=".json"
export BASH_EXT=".bash"
export CONF_EXT=".conf"
export PYTHON_EXT=".py"


###########################################################################################################################################
# Define Script Local Filesystem Environment Constants
CALLING_SCRIPT_PATH="$(realpath "${BASH_SOURCE[${SCRIPT_NAME_ID}]}")"
CALLING_SCRIPT_NAME="$( [[ "$1" != "" ]] && echo "$1" || echo "$(basename "${CALLING_SCRIPT_PATH}")" )"

CURRENT_SCRIPT_PATH="$(realpath "${BASH_SOURCE[$(( SCRIPT_NAME_ID - 1 ))]}")"
CURRENT_SCRIPT_NAME="$(basename "${CURRENT_SCRIPT_PATH}")"

export CLOSE_DIR="$(dirname "${CURRENT_SCRIPT_PATH}")"


###########################################################################################################################################
# Initialize logging functions by sourcing logging config file
export INIT_CLOSE_LOGGING_FILENAME="close_logging${CONF_EXT}"
export INIT_CLOSE_LOGGING="${CLOSE_DIR}/${INIT_CLOSE_LOGGING_FILENAME}"

source "${INIT_CLOSE_LOGGING}"
log_debug "Loaded ${INIT_CLOSE_LOGGING_FILENAME} for ${CALLING_SCRIPT_NAME}"
log_debug "BASH_SOURCE[$(( SCRIPT_NAME_ID + 1 ))]: \"${BASH_SOURCE[$(( SCRIPT_NAME_ID+1 ))]}\""
log_debug "BASH_SOURCE[${SCRIPT_NAME_ID}]: \"${BASH_SOURCE[${SCRIPT_NAME_ID}]}\""
log_debug "BASH_SOURCE[*]: \"${BASH_SOURCE[*]}\""


###########################################################################################################################################
# Define Script File Constants
export CLOSE_PYTHON_FILENAME="close_buildwithus${PYTHON_EXT}"
export CLOSE_JSON_FILENAME="close_buildwithus_rsp${JSON_EXT}"
export CLOSE_HASHED_TRAITS_FILENAME="close_buildwithus_hash${JSON_EXT}"
export CLOSE_HASHED_RESPONSE_FILENAME="close_buildwithus_hash_rsp${JSON_EXT}"

export CLOSE_JSON_FILE="${CLOSE_DIR}/${CLOSE_JSON_FILENAME}"
export CLOSE_PYTHON_FILE="${CLOSE_DIR}/${CLOSE_PYTHON_FILENAME}"
export CLOSE_HASHED_TRAITS_FILE="${CLOSE_DIR}/${CLOSE_HASHED_TRAITS_FILENAME}"
export CLOSE_HASHED_RESPONSE_FILE="${CLOSE_DIR}/${CLOSE_HASHED_RESPONSE_FILENAME}"

export API_REQUEST_BASH="api_request${BASH_EXT}"
export API_REQUEST_BASH_FILE="${CLOSE_DIR}/${API_REQUEST_BASH}"
export API_REQUEST_BASH_SCRIPT="${API_REQUEST_BASH_FILE}"


###########################################################################################################################################
# Reset script name back to calling script
log_debug "Resetting script name to calling script: ${CALLING_SCRIPT_NAME}"
export SCRIPT_NAME="${CALLING_SCRIPT_NAME}"
