#!/usr/bin/env bash
#####################################################################################################################################################################################################
# Project:       Juniper
# Prototype:     Monitoring and Diagnostic Frontend for Cascade Correlation Neural Network
# File Name:     init.conf
# Author:        Paul Calnon
# Version:       0.1.4 (0.7.3)
#
# Date:          2025-11-10
# Last Modified: 2025-12-03
#
# License:       MIT License
# Copyright:     Copyright (c) 2024-2025 Paul Calnon
#
# Description:
#    This Script serves as the initialization config file for the Juniper Project's juniper_canopy prototype
#    Warning:  This Script / Config file is sourced by the try.bash script
#
#####################################################################################################################################################################################################
# Notes:
#     Warning:  This Config file is sourced by the try.bash script
#
#####################################################################################################################################################################################################
# References:
#
#####################################################################################################################################################################################################
# TODO :
#
#####################################################################################################################################################################################################
# COMPLETED:
#
#####################################################################################################################################################################################################


#####################################################################################################################################################################################################
# Define Top Level Constants for Script
#####################################################################################################################################################################################################
export TRUE="0"
export FALSE="1"

# export DEBUG="${FALSE}"
export DEBUG="${TRUE}"


BASH_EXT="bash"
CONF_EXT="conf"
UTIL_DIR_NAME="util"

COMMON_CONF_PREFIX="common"
LOGGING_CONF_PREFIX="logging"

export COMMON_CONF_FILE_NAME="${COMMON_CONF_PREFIX}.${CONF_EXT}"
echo "Common conf file name: ${COMMON_CONF_FILE_NAME}"
export LOGGING_CONF_FILE_NAME="${LOGGING_CONF_PREFIX}.${CONF_EXT}"
echo "Logging conf file name: ${LOGGING_CONF_FILE_NAME}"


#####################################################################################################################################################################################################
# Current Config file info
#####################################################################################################################################################################################################
SCRIPT_PATH="$(realpath "${BASH_SOURCE[0]}")"
echo "Script Path: ${SCRIPT_PATH}"
SCRIPT_NAME="$(basename "${SCRIPT_PATH}")"
echo "Script Name: ${SCRIPT_NAME}"
SCRIPT_DIR="$(dirname "${SCRIPT_PATH}")"
echo "Script Dir: ${SCRIPT_DIR}"

PROJ_ROOT_DIR="$(dirname "${SCRIPT_DIR}")"
echo "Project Root Dir: ${PROJ_ROOT_DIR}"

SCRIPT_NAME_ROOT="${SCRIPT_NAME%.*}"
echo "Script Name Root: ${SCRIPT_NAME_ROOT}"

# CONF_FILENAME="${SCRIPT_NAME_ROOT}.${CONF_EXT}"
# echo "Config Filename: ${CONF_FILENAME}"
CONF_DIR="${PROJ_ROOT_DIR}/${CONF_EXT}"
echo "Config Dir: ${CONF_DIR}"
# PARENT_CONF_FILE="${CONF_DIR}/${CONF_FILENAME}"
# echo "Parent Conf File: ${PARENT_CONF_FILE}"


#####################################################################################################################################################################################################
# Get parent script info and constants
#####################################################################################################################################################################################################
PARENT_PID="${PPID}"
[[ "${DEBUG}" == "${TRUE}" ]] && echo "Child: Parent Pid:                \"${PARENT_PID}\""

# PARENT_CMD="$(tr -d '\0' </proc/${PARENT_PID}/cmdline)"
# [[ "${DEBUG}" == "${TRUE}" ]] && echo "Child: Parent Path: From Cmd:     \"${PARENT_CMD}\""

PARENT_CALL="$(ps -o args= ${PARENT_PID})"
echo "Parent Raw Call: From ps:  \"$PARENT_CALL\""
PARENT_SCRIPT_REL="$(echo "${PARENT_CALL}" | awk '{print $2}')"
echo "Parent Rel Path: ${PARENT_SCRIPT_REL}"
PARENT_SCRIPT_PATH="$(realpath "${PARENT_SCRIPT_REL}")"
echo "Parent Abs Path: ${PARENT_SCRIPT_PATH}"
PARENT_CONF="${PARENT_SCRIPT_PATH%.*}.${CONF_EXT}"
echo "Parent Config: ${PARENT_CONF}"
PARENT_CONF_FILENAME="$(basename "${PARENT_CONF}")"
echo "Parent Config Filename: ${PARENT_CONF_FILENAME}"
PARENT_DIR="$(dirname "${PARENT_CONF}")"
echo "Parent Dir: ${PARENT_DIR}"
PARENT_ROOT_DIR="$(dirname "${PARENT_DIR}")"
echo "Parent Root Dir: ${PARENT_ROOT_DIR}"
PARENT_CONF_DIR="${PARENT_ROOT_DIR}/${CONF_EXT}"
echo "Parent Conf Dir: ${PARENT_CONF_DIR}"
PARENT_CONF_FILE="${PARENT_CONF_DIR}/${PARENT_CONF_FILENAME}"
echo "Parent Conf File: ${PARENT_CONF_FILE}"


#####################################################################################################################################################################################################
# Get project directory constants
#####################################################################################################################################################################################################
export HOME_DIR="${HOME}"
export PROJ_NAME="Juniper"
export SUB_PROJ_NAME="JuniperCanopy"
export APP_NAME="juniper_canopy"
export PROJ_LANG_DIR_NAME="python"
export DEV_DIR_NAME="Development"
export DEV_DIR="${HOME_DIR}/${DEV_DIR_NAME}"
export PROJ_ROOT_DIR="${DEV_DIR}/${PROJ_LANG_DIR_NAME}"
export PROJ_DIR="${PROJ_ROOT_DIR}/${SUB_PROJ_NAME}/${APP_NAME}"
export PROJ_UTIL_DIR="${PROJ_DIR}/${UTIL_DIR_NAME}"
export PROJ_CONF_DIR="${PROJ_DIR}/${CONF_EXT}"


#####################################################################################################################################################################################################
# Validate config dir
#####################################################################################################################################################################################################
if [[ ( ( "${PARENT_CONF_DIR}" == "" ) || ( ! -d "${PARENT_CONF_DIR}" ) ) && ( ( "${PROJ_CONF_DIR}" == "" ) && ( ! -d "${PROJ_CONF_DIR}" ) ) ]]; then
    echo "Error: Both Parent Conf Dir: \"${PARENT_CONF_DIR}\" and Project Conf Dir: \"${PROJ_CONF_DIR}\" are empty or do not exist"
    exit 1
elif [[ ( "${PARENT_CONF_DIR}" == "" ) || ( ! -d "${PARENT_CONF_DIR}" ) ]]; then
    CONF_DIR="${PROJ_CONF_DIR}"
    echo "Parent Conf Dir: \"${PARENT_CONF_DIR}\", is empty or does not exist, using Project Conf Dir: \"${PROJ_CONF_DIR}\""
else
    CONF_DIR="${PARENT_CONF_DIR}"
    echo "Parent Conf Dir: \"${PARENT_CONF_DIR}\" is valid, using Parent Conf Dir"
fi


#####################################################################################################################################################################################################
# Build and Validate the Common Config File
#####################################################################################################################################################################################################
export COMMON_CONF_FILE="${CONF_DIR}/${COMMON_CONF_FILE_NAME}"
echo "COMMON_CONF_FILE: ${COMMON_CONF_FILE}"

# Validate the common config file
if [[ ! -f "${COMMON_CONF_FILE}" ]]; then
    echo "Error: Common Config File: \"${COMMON_CONF_FILE}\" does not exist"
    exit 1
fi


#####################################################################################################################################################################################################
# Build and Validate the Logging Config File
#####################################################################################################################################################################################################
export LOGGING_CONF_FILE="${CONF_DIR}/${LOGGING_CONF_FILE_NAME}"
echo "LOGGING_CONF_FILE: ${LOGGING_CONF_FILE}"

# Validate the logging config file
if [[ ! -f "${LOGGING_CONF_FILE}" ]]; then
    echo "Error: Logging Config File: \"${LOGGING_CONF_FILE}\" does not exist"
    exit 1
fi


#####################################################################################################################################################################################################
# Validate Parent Script Primary config file
#####################################################################################################################################################################################################
CONF_FILE="${PARENT_CONF_FILE}"
echo "CONF_FILE: ${CONF_FILE}"

# Validate the Parent Script's primary config file
if [[ "${CONF_FILE}" == "" ]]; then
    echo "Error: Config File: \"${CONF_FILE}\" is empty"
    exit 1
elif [[ ! -f "${CONF_FILE}" ]]; then
    echo "Error: Config File: \"${CONF_FILE}\" does not exist"
    exit 1
else
    echo "Config File: \"${CONF_FILE}\" is valid"
fi


#####################################################################################################################################################################################################
# Source the config files
#####################################################################################################################################################################################################
# Source the logging config file
echo "Logging Conf File: \"${LOGGING_CONF_FILE}\""
echo "source \"${LOGGING_CONF_FILE}\""
source "${LOGGING_CONF_FILE}"

# Source the common config file
echo "Common Conf File: \"${COMMON_CONF_FILE}\""
echo "source \"${COMMON_CONF_FILE}\""
source "${COMMON_CONF_FILE}"

# Source the primary config file for the parent script
echo "Conf file: \"${CONF_FILE}\""
echo "source \"${CONF_FILE}\""
source "${CONF_FILE}"



# Logging Config File Sourced
# source "/home/pcalnon/Development/python/JuniperCanopy/juniper_canopy/conf/logging.conf"
# Logging Config File Sourced
# CONF_FILENAME: init.conf
# init.conf: Debug: Project Based Conf File: /home/pcalnon/Development/python/JuniperCanopy/juniper_canopy/conf/init.conf
# Conf file: "/home/pcalnon/Development/python/JuniperCanopy/juniper_canopy/conf/init.conf"
# Parent Conf File: "/home/pcalnon/Development/python/JuniperCanopy/juniper_canopy/conf/init.conf"
# init.conf: Debug: Verified Conf File: /home/pcalnon/Development/python/JuniperCanopy/juniper_canopy/conf/init.conf, exists
# source "/home/pcalnon/Development/python/JuniperCanopy/juniper_canopy/conf/init.conf"
# Common conf file name: common.conf
# Logging conf file name: logging.conf


# # Source the common config file for util scripts
# echo "source \"${COMMON_CONF_FILE}\""
# source "${COMMON_CONF_FILE}"
#####################################################################################################################################################################################################
# Source the logging config file for util scripts
#####################################################################################################################################################################################################
# echo "source \"${LOGGING_CONF_FILE}\""
# source "${LOGGING_CONF_FILE}"


#####################################################################################################################################################################################################
# Source the Primary Config file for the Calling, Parent script
#####################################################################################################################################################################################################
# TODO:  This is borked.  it should be referencing the get_code_status.bash file.  instead, it's referencing this init.conf file again.
# echo "CONF_FILENAME: ${CONF_FILENAME}"
# export CONF_FILE="${CONF_DIR}/${CONF_FILENAME}"
# [[ "${CONF_FILE}" == "${PARENT_CONF_FILE}" ]] && echo "${SCRIPT_NAME}: Debug: Project Based Conf File: ${CONF_FILE}" || echo "${SCRIPT_NAME}: Warning: Parent Derived Conf File: \"${PARENT_CONF_FILE}\",  Differs from Project Based Conf File: \"${CONF_FILE}\""
#####################################################################################################################################################################################################
# export PATH_DELIMITER="/" && log_debug "Path Delimiter: ${PATH_DELIMITER}"
# export CONFIG_DIR_NAME="conf" && log_debug "Config Dir Name: ${CONFIG_DIR_NAME}"
# export SOURCE_DIR_NAME="src" && log_debug "Source Dir Name: ${SOURCE_DIR_NAME}"
# export PROTOTYPES_DIR_NAME="prototypes" && log_debug "Prototypes Dir Name: ${PROTOTYPES_DIR_NAME}"
# export CONFIG_FILE_SUFFIX="conf" && log_debug "Config File Suffix: ${CONFIG_FILE_SUFFIX}"
#
#
# export ABS_SCRIPT_PATH="$(dirname "$(realpath "$0")")" && log_debug "Abs Script Path: ${ABS_SCRIPT_PATH}"
# export PROTOTYPE_NAME="$(basename "${ABS_SCRIPT_PATH}")" && log_debug "Prototype Name: ${PROTOTYPE_NAME}"
#
# export ABS_PROTOTYPES_DIR_PATH="$(dirname "${ABS_SCRIPT_PATH}")" && log_debug "Abs Prototypes Dir Path: ${ABS_PROTOTYPES_DIR_PATH}"
# export PROTOTYPES_DIR_NAME="$(basename "${ABS_PROTOTYPES_DIR_PATH}")" && log_debug "Prototypes Dir Name: ${PROTOTYPES_DIR_NAME}"
#
# export ABS_UTIL_PATH="$(dirname "${ABS_PROTOTYPES_DIR_PATH}")" && log_debug "Abs Util Path: ${ABS_UTIL_PATH}"
# export UTIL_DIR_NAME="$(basename "${ABS_UTIL_PATH}")" && log_debug "Util Dir Name: ${UTIL_DIR_NAME}"
#
#
# #####################################################################################################################################################################################################
# # Define Project Directory Constants
# #####################################################################################################################################################################################################
# export ABS_PROJECT_PATH="$(dirname "${ABS_UTIL_PATH}")" && log_debug "Abs Project Path: ${ABS_PROJECT_PATH}"
# export PROJECT_NAME="$(basename "${ABS_PROJECT_PATH}")" && log_debug "Project Name: ${PROJECT_NAME}"
# export PROJECT_SOURCE_DIR_PATH="${ABS_PROJECT_PATH}${PATH_DELIMITER}${SOURCE_DIR_NAME}" && log_debug "Project Source Dir Path: ${PROJECT_SOURCE_DIR_PATH}"
# export PROJECT_PROTOTYPES_DIR_PATH="${PROJECT_SOURCE_DIR_PATH}${PATH_DELIMITER}${PROTOTYPES_DIR_NAME}" && log_debug "Project Prototypes Dir Path: ${PROJECT_PROTOTYPES_DIR_PATH}"
#
#
# #####################################################################################################################################################################################################
# # Define Prototype Directory Constants
# #####################################################################################################################################################################################################
# export PROTOTYPE_DIR_PATH="${PROJECT_PROTOTYPES_DIR_PATH}${PATH_DELIMITER}${PROTOTYPE_NAME}" && log_debug "Prototype Dir Path: ${PROTOTYPE_DIR_PATH}"
# export SOURCE_DIR_PATH="${PROTOTYPE_DIR_PATH}${PATH_DELIMITER}${SOURCE_DIR_NAME}" && log_debug "Source Dir Path: ${SOURCE_DIR_PATH}"
# export CONFIG_DIR_PATH="${PROTOTYPE_DIR_PATH}${PATH_DELIMITER}${CONFIG_DIR_NAME}" && log_debug "Config Dir Path: ${CONFIG_DIR_PATH}"
#
#
# #####################################################################################################################################################################################################
# # Define Config File Name Constants
# #####################################################################################################################################################################################################
# export COMMON_CONFIG_FILE_NAME="common.${CONFIG_FILE_SUFFIX}" && log_debug "Common Config File Name: ${COMMON_CONFIG_FILE_NAME}"
# export TEST_COMMON_CONFIG_FILE_NAME="test_common_${CONFIG_FILE_SUFFIX}.bash" && log_debug "Test Common Config File Name: ${TEST_COMMON_CONFIG_FILE_NAME}"
#
# export COMMON_CONFIG_FILE="${CONFIG_DIR_PATH}${PATH_DELIMITER}${COMMON_CONFIG_FILE_NAME}" && log_debug "Common Config File: ${COMMON_CONFIG_FILE}"
# export TEST_COMMON_CONFIG_FILE="${CONFIG_DIR_PATH}${PATH_DELIMITER}${TEST_COMMON_CONFIG_FILE_NAME}" && log_debug "Test Common Config File: ${TEST_COMMON_CONFIG_FILE}"
#
# export PROTOTYPE_CONFIG_FILE_NAME="${PROTOTYPE_NAME}.${CONFIG_FILE_SUFFIX}" && log_debug "Prototype Config File Name: ${PROTOTYPE_CONFIG_FILE_NAME}"
#
#
# #####################################################################################################################################################################################################
# # Source the common config file
# #####################################################################################################################################################################################################
# log_debug "Common Config File Params: ${COMMON_CONFIG_FILE}, for Prototype Name: ${PROTOTYPE_NAME}, Project Name: ${PROJECT_NAME}, Prototype Config File Name: ${PROTOTYPE_CONFIG_FILE_NAME}"
# if [[ "${DEBUG}" == "${FALSE}" ]]; then
#     log_info "Sourcing Common Config File: ${COMMON_CONFIG_FILE} ${SCRIPT_NAME} ${PROTOTYPE_NAME} ${PROJECT_NAME} ${PROTOTYPE_CONFIG_FILE_NAME}"
#     source "${COMMON_CONFIG_FILE}" "${SCRIPT_NAME}" "${PROTOTYPE_NAME}" "${PROJECT_NAME}" "${PROTOTYPE_CONFIG_FILE_NAME}"
# else
#     log_info "Calling the Test Common Config File Script: ${TEST_COMMON_CONFIG_FILE} ${SCRIPT_NAME} ${PROTOTYPE_NAME} ${PROJECT_NAME} ${PROTOTYPE_CONFIG_FILE_NAME}"
#     "${TEST_COMMON_CONFIG_FILE}" "${SCRIPT_NAME}" "${PROTOTYPE_NAME}" "${PROJECT_NAME}" "${PROTOTYPE_CONFIG_FILE_NAME}"
# fi
# log_info "Completed Sourcing Common Config File: ${COMMON_CONFIG_FILE}, for Prototype Name: ${PROTOTYPE_NAME}, Project Name: ${PROJECT_NAME}, Prototype Config File Name: ${PROTOTYPE_CONFIG_FILE_NAME}"
