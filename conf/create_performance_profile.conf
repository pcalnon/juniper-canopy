#!/usr/bin/env bash
#####################################################################################################################################################################################################
# Project:       Juniper
# Sub-Project:   JuniperCanopy
# Application:   juniper_canopy
# Purpose:       Monitoring and Diagnostic Frontend for Cascade Correlation Neural Network
#
# Author:        Paul Calnon
# Version:       0.1.4 (0.7.3)
# File Name:     create_performance_profile.conf
# File Path:     <Project>/<Sub-Project>/<Application>/conf/
#
# Date:          2025-10-11
# Last Modified: 2026-01-03
#
# License:       MIT License
# Copyright:     Copyright (c) 2024,2025,2026 Paul Calnon
#
# Description:
#     This script Profiles the Python class for optimization
#
#####################################################################################################################################################################################################
# Notes:
#
########################################################################################################)#############################################################################################
# References:
#
#####################################################################################################################################################################################################
# TODO :
#
#####################################################################################################################################################################################################
# COMPLETED:
#
#####################################################################################################################################################################################################


#####################################################################################################################################################################################################
# Only Source this conf file Once
#####################################################################################################################################################################################################
if [[ "${CREATE_PERFORMANCE_PROFILE_SOURCED}" != "${TRUE}" ]]; then
    export CREATE_PERFORMANCE_PROFILE_SOURCED="${TRUE}"
else
    log_warning "create_performance_profile.conf already sourced.  Skipping re-source."
    return $(( TRUE ))
fi


#######################################################################################################################################################################################
# Define the Script Environment File Constants
#######################################################################################################################################################################################
log_trace "Define Script Environment File Constants"
GET_FILENAMES_SCRIPT_NAME="get_module_filenames.bash"
export GET_FILENAMES_SCRIPT="${UTIL_DIR}/${GET_FILENAMES_SCRIPT_NAME}"
GET_SOURCETREE_SCRIPT_NAME="source_tree.bash"
export GET_SOURCETREE_SCRIPT="${UTIL_DIR}/${GET_SOURCETREE_SCRIPT_NAME}"
GET_TODO_COMMENTS_SCRIPT_NAME="get_todo_comments.bash"
export GET_TODO_COMMENTS_SCRIPT="${UTIL_DIR}/${GET_TODO_COMMENTS_SCRIPT_NAME}"
GET_FILE_TODO_SCRIPT_NAME="get_file_todo.bash"
export GET_FILE_TODO_SCRIPT="${UTIL_DIR}/${GET_FILE_TODO_SCRIPT_NAME}"
GIT_LOG_WEEKS_SCRIPT_NAME="__git_log_weeks.bash"
export GIT_LOG_WEEKS_SCRIPT="${UTIL_DIR}/${GIT_LOG_WEEKS_SCRIPT_NAME}"
PYTHON_FILE_NAME="main.py"
export PYTHON_FILE="${SRC_DIR}/${PYTHON_FILE_NAME}"
export OUTPUT_FILE_NAME_ROOT="Juniper"
export OUTPUT_FILE_NAME_EXT="prof"
# shellcheck disable=SC2155
export DATE_STAMP="$(date +%F_%T)"
export OUTPUT_FILE_NAME="${OUTPUT_FILE_NAME_ROOT}_${DATE_STAMP}.${OUTPUT_FILE_NAME_EXT}"
export OUTPUT_FILE="${CONF_DIR}/${OUTPUT_FILE_NAME}"


#######################################################################################################################################################################################
# Define the Script Constants
#    /Users/pcalnon/opt/anaconda3/envs/pytorch_cuda/bin/python
#######################################################################################################################################################################################
log_trace "Define Script Parameter Constants"
export PYTHON_NAME="python"
export PYTHON_ENV_ROOT="/opt/miniforge3/envs/JuniperCanopy/bin"
export PYTHON_ENV="${PYTHON_ENV_ROOT}/${PYTHON_NAME}"
export OS_TYPE="ubuntu"
export OS_TYPE_PREFIX="macOS"
export ENV_PREFIX="opt"
if [[ -f "$(which sw_vers)" ]]; then
    # shellcheck disable=SC2155
    export OS_TYPE="$(sw_vers -ProductName)"
fi
if [[ "${OS_TYPE}" == "${OS_TYPE_PREFIX}" ]]; then
    export PYTHON_ENV="${ENV_PREFIX}/${PYTHON_ENV}"
fi
export PYTHON="${HOME}/${PYTHON_ENV}"
export PROFILER="cProfile"


#######################################################################################################################################################################################
# Source the functions conf file
#######################################################################################################################################################################################
log_trace "Source the functions conf file"
export CREATE_PERFORMANCE_PROFILE_FUNCTIONS_FILE_NAME_INFIX="_functions"
export CREATE_PERFORMANCE_PROFILE_FUNCTIONS_NAME_CONF="$( basename "${BASH_SOURCE[0]}" )"
export CREATE_PERFORMANCE_PROFILE_FUNCTIONS_NAME_ROOT="${CREATE_PERFORMANCE_PROFILE_FUNCTIONS_NAME_CONF%.*}${CREATE_PERFORMANCE_PROFILE_FUNCTIONS_FILE_NAME_INFIX}.${CONF_EXT}"
export CREATE_PERFORMANCE_PROFILE_FUNCTIONS_CONF="${CONF_DIR}/${CREATE_PERFORMANCE_PROFILE_FUNCTIONS_NAME_ROOT}"
if [[ ( "${CREATE_PERFORMANCE_PROFILE_FUNCTIONS_CONF}" == "" ) || ( ! -f "${CREATE_PERFORMANCE_PROFILE_FUNCTIONS_CONF}" ) ]]; then
    log_warning "create_performance_profile_functions.conf not found."
else
    log_debug "create_performance_profile_functions.conf found."
    source "${CREATE_PERFORMANCE_PROFILE_FUNCTIONS_CONF}"; SUCCESS="$?"
fi
[[ "${SUCCESS}" != "${TRUE}" ]] && log_error "Failed to source create_performance_profile_functions.conf." || log_info "Successfully sourced create_performance_profile_functions.conf."


#######################################################################################################################################################################################
# Run env info functions
#######################################################################################################################################################################################
log_trace "Run env info functions"
# shellcheck disable=SC2155
export BASE_DIR=$(${GET_PROJECT_SCRIPT} "${BASH_SOURCE[0]}")
# shellcheck disable=SC2155
export CURRENT_OS=$(${GET_OS_SCRIPT})   # Determine Host OS


#######################################################################################################################################################################################
# Define Parameter Constants
#######################################################################################################################################################################################
log_trace "Define Parameter Constants"
export MODULE_FLAG="-m"
export OUTPUT_FLAG="-o"
export MODULE_PARAM="${MODULE_FLAG} ${PROFILER}"
export OUTPUT_PARAM="${OUTPUT_FLAG} ${OUTPUT_FILE}"
# shellcheck disable=SC2034
export PARAM_LIST="${MODULE_PARAM} ${OUTPUT_PARAM}"

return $(( TRUE ))
