#!/usr/bin/env bash
#####################################################################################################################################################################################################
# Project:       Juniper
# Prototype:     juniper_canopy, juniper_cascor
# File Name:     common.conf
# Author:        Paul Calnon
# Version:       0.1.4 (0.7.3)
#
# Date:          2025-11-05
# Last Modified: 2025-12-03
#
# License:       MIT License
# Copyright:     Copyright (c) 2024-2025 Paul Calnon
#
# Description:
#    This is the common config file for the Juniper Project and Juniper Project Prototypes
#
#####################################################################################################################################################################################################
# Notes:
#
#####################################################################################################################################################################################################
# References:
#
#####################################################################################################################################################################################################
# TODO :
#
#####################################################################################################################################################################################################
# COMPLETED:
#
#####################################################################################################################################################################################################


#####################################################################################################################################################################################################
# Define Script Constants
#####################################################################################################################################################################################################
export TRUE="0"
export FALSE="1"

export DEBUG="${FALSE}"
# export DEBUG="${TRUE}"


#####################################################################################################################################################################################################
# Define Common Script Constants
#####################################################################################################################################################################################################
export CONFIG_FILE_NAME="$(basename "$(realpath "${0}")")"

echo "Config File Name: ${CONFIG_FILE_NAME}"


#####################################################################################################################################################################################################
# Define Common Script Constants
#####################################################################################################################################################################################################
log_info "Config File: \"${CONFIG_FILE_NAME}\""

export PROJECT_NAME_DEFAULT="Juniper"  && log_debug "Project Name Default: \"${PROJECT_NAME_DEFAULT}\""
export PROTOTYPE_DIR_NAME="prototypes" && log_debug "Prototype Dir Name: \"${PROTOTYPE_DIR_NAME}\""
export SOURCE_DIR_NAME="src"           && log_debug "Source Dir Name: \"${SOURCE_DIR_NAME}\""
export CONFIG_DIR_NAME="conf"          && log_debug "Config Dir Name: \"${CONFIG_DIR_NAME}\""
export UTIL_DIR_NAME="util"            && log_debug "Util Dir Name: \"${UTIL_DIR_NAME}\""
export CONFIG_EXT="conf"               && log_debug "Config Ext: \"${CONFIG_EXT}\""


#####################################################################################################################################################################################################
# Parse and Validate Input Parameters
#####################################################################################################################################################################################################
export SCRIPT_NAME="$(       [[ "${1}" == "" ]] && echo "$(basename "$(realpath "$0")")"    || echo "${1}" )" && shift && log_debug "Input Param Script Name: \"${SCRIPT_NAME}\""
export PROTOTYPE_NAME="$(    [[ "${1}" == "" ]] && echo "${PROJECT_NAME_DEFAULT,,}"         || echo "${1}" )" && shift && log_debug "Input Param Prototype Name: \"${PROTOTYPE_NAME}\""
export PROJECT_NAME="$(      [[ "${1}" == "" ]] && echo "${PROJECT_NAME_DEFAULT,,}"         || echo "${1}" )" && shift && log_debug "Input Param Project Name: \"${PROJECT_NAME}\""
export CONFIG_FILE_INPUT="$( [[ "${1}" == "" ]] && echo "${PROTOTYPE_NAME,,}.${CONFIG_EXT}" || echo "${1}" )" && shift && log_debug "Input Param Config File Input: \"${CONFIG_FILE_INPUT}\""


#####################################################################################################################################################################################################
# Determine Current Directory
#####################################################################################################################################################################################################
export CURRENT_DIR="$(dirname "$(realpath "$0")")"                                           && log_debug "Current Directory: \"${CURRENT_DIR}\""
export PROJECT_DIR_ROOT="$(echo "${CURRENT_DIR}" | awk -F "${PROJECT_NAME}" '{print $1;}' )" && log_debug "Project Directory Root: \"${PROJECT_DIR_ROOT}\""
export PROJECT_DIR="${PROJECT_DIR_ROOT:0:-1}/${PROJECT_NAME}"                                && log_debug "Project Directory: \"${PROJECT_DIR}\""


#####################################################################################################################################################################################################
# Build Prototype specific config file path
#####################################################################################################################################################################################################
export CONFIG_DIR_ROOT="${PROJECT_DIR}"                                && log_debug "Config Dir Root: \"${CONFIG_DIR_ROOT}\""
export CONFIG_PARENT_DIR="${CONFIG_DIR_ROOT}/${CONFIG_DIR_NAME}"       && log_debug "Config Dir Parent Dir: \"${CONFIG_PARENT_DIR}\""

export CONFIG_DIR="$( [[ "${PROTOTYPE_NAME}" != "${PROJECT_NAME,,}" ]] && echo "${CONFIG_PARENT_DIR}/${PROTOTYPE_DIR_NAME}/${PROTOTYPE_NAME}" || echo "${CONFIG_PARENT_DIR}" )" && log_debug "Config Dir: ${CONFIG_DIR}"

export CONFIG_FILE="${CONFIG_DIR}/${CONFIG_FILE_INPUT}"                && log_debug "Config File: \"${CONFIG_FILE}\""


#####################################################################################################################################################################################################
# Determine Calling Script Directory
#####################################################################################################################################################################################################
export CALLING_SCRIPT_DIR_ROOT="$( [[ "${PROJECT_NAME,,}" != "${PROTOTYPE_NAME}" ]] && echo "${PROJECT_DIR}/${SOURCE_DIR_NAME}/${PROTOTYPE_DIR_NAME}/${PROTOTYPE_NAME}" || echo "${PROJECT_DIR}")" && log_debug "Calling Script Dir Root: \"${CALLING_SCRIPT_DIR_ROOT}\""
export CALLING_SCRIPT_DIR_PATH="${CALLING_SCRIPT_DIR_ROOT}/${UTIL_DIR_NAME}" && log_debug "Calling Script Dir Path: \"${CALLING_SCRIPT_DIR_PATH}\""
export CALLING_SCRIPT_PATH="${CALLING_SCRIPT_DIR_PATH}/${SCRIPT_NAME}"       && log_debug "Calling Script Path: \"${CALLING_SCRIPT_PATH}\""


#####################################################################################################################################################################################################
# Source the Prototype specific config file
#####################################################################################################################################################################################################
log_info "Calling the Prototype specific config file: \"${CONFIG_FILE}\""
if [[ "${DEBUG}" == "${TRUE}" ]]; then
    TESTING_SCRIPT_NAME="test_prototype_conf.bash" && log_debug "Testing Script Name: ${TESTING_SCRIPT_NAME}"
    TESTING_SCRIPT="${CONFIG_DIR}/${TESTING_SCRIPT_NAME}" && log_debug "Testing Script: ${TESTING_SCRIPT}"
    log_info "Launching the Prototype specific config file, by Running the Test Script: \"${TESTING_SCRIPT}\""
    ${TESTING_SCRIPT} "${SCRIPT_NAME}" "${CALLING_SCRIPT_PATH}"
    log_info "Completed Running the Prototype specific config file"
else
    log_info "Sourcing the Prototype specific config file"
    source ${CONFIG_FILE} "${SCRIPT_NAME}" "${CALLING_SCRIPT_PATH}"
    log_info "Completed Sourcing the Prototype specific config file"
fi
log_info "Completed Calling the Prototype-Specific config file."
